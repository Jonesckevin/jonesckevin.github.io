<!DOCTYPE html>
<html lang="{{ .Site.Language }}">

<head>
    {{ partial "head.html" . }}
    {{ if .Params.customCSS }}
    <link rel="stylesheet" href="{{ .Params.customCSS }}">
    {{ end }}
</head>

<body class="section-{{ lower .Section }}{{ if .Params.thumbnailOnlyView }} thumbnail-only-view{{ end }}">

    <div class="container">
        {{ partial "header.html" . }}
        {{ partial "side-menu-LR.html" . }}

        <div class="content">
            <main class="main-content">
                <div class="hero-section">
                    <div class="hero-header">
                        <h1 class="hero-title">{{ .Title }}</h1>
                        {{ if eq .Section "ai-tools" }}
                        <button class="ai-help-btn page-help-btn" id="page-ai-help-toggle"
                            aria-label="Show AI Tools Help" title="How to use AI Tools">‚ùì</button>
                        {{ end }}
                    </div>
                    {{ with .Description }}
                    <p class="hero-description">{{ . }}</p>
                    {{ end }}

                    {{ if not .Params.disableSearch }}
                    <!-- Search Filter -->
                    <div class="search-filter">
                        <input type="text" id="sectionSearch" placeholder="üîç {{ .Params.searchPlaceholder | default "Search..." }}" class="search-input">
                        <div id="searchResults" class="search-results"></div>
                    </div>
                    {{ end }}

                    {{ if eq .Section "ai-tools" }}
                    <!-- Help Section for AI Tools Page -->
                    <div class="page-ai-help-section" id="page-ai-help-section" style="display: none;">
                        <div class="ai-help-content">
                            <h4>How to Use AI Tools</h4>
                            <img src="/images/help/ai-tool-help.gif" alt="AI Tools Tutorial" class="ai-help-gif">
                            <p class="ai-help-description">
                            <ul class="ai-help-list">
                                <li>Configure your AI provider by selecting one from the dropdown. <a
                                        href="https://platform.openai.com/api-keys" id="page-provider-link"
                                        target="_blank" rel="noopener noreferrer">OpenAI API website</a></li>
                                <li>Enter your API key. <span id="page-key-format">Format: <code>sk-...</code></span>
                                </li>
                                <li>Optionally choose a specific model. <a href="https://openai.com/api/pricing/"
                                        id="page-pricing-link" target="_blank" rel="noopener noreferrer">View
                                        pricing</a></li>
                                <li>Visit any AI tool page to start using powerful AI-driven features like story
                                    generators, quiz
                                    creators, and more.</li>
                                <li>Your API key is stored securely in your browser session and never sent to our
                                    servers.</li>
                            </ul>
                            </p>
                        </div>
                    </div>
                    {{ end }}
                </div>

                {{ .Content }}

                <div class="services-grid" id="servicesGrid">
                    {{/* Check if showing all descendant pages or just immediate children */}}
                    {{ if .Params.showAllDescendants }}
                    {{/* Show all leaf pages (products/items) recursively */}}
                    {{ range .Site.RegularPages }}
                    {{ if and (in .File.Dir $.File.Dir) (not .IsSection) (not .Params.hideFromListing) }}
                    <a href="{{ .Permalink }}" class="service-card" data-title="{{ .Title | lower }}"
                        data-description="{{ with .Description }}{{ . | lower }}{{ else }}{{ .Summary | plainify | lower }}{{ end }}"
                        data-tags="{{ if .Params.tags }}{{ delimit .Params.tags " " | lower }}{{ end }}{{ if .Params.brand }} {{ .Params.brand | lower }}{{ end }}{{ if .Params.model }} {{ .Params.model | lower }}{{ end }}">
                        <div class="card-header">
                            <h3>{{ .Title }}</h3>
                        </div>
                        <div class="card-content">
                            <div class="card-content-wrapper">
                                {{ if not $.Params.hideDescriptions }}
                                {{ with .Description }}
                                <p>{{ . }}</p>
                                {{ else }}
                                <p>{{ .Summary | plainify | truncate 150 }}</p>
                                {{ end }}
                                {{ end }}
                                {{/* Show brand/category for context when showing all items */}}
                                {{ if or .Params.brand .Params.model }}
                                <div class="item-meta" style="margin-top: 0.5rem; font-size: 0.85em; opacity: 0.7;">
                                    {{ if .Params.brand }}<span class="brand-label">{{ .Params.brand }}</span>{{ end }}
                                    {{ if .Params.model }}<span class="model-label">{{ .Params.model }}</span>{{ end }}
                                </div>
                                {{ end }}
                            </div>
                        </div>
                        {{ if not $.Params.hideThumbnails }}
                        <div class="card-thumbnail">
                            {{ if .Params.thumbnail }}
                            <img src="{{ .Params.thumbnail | absURL }}" alt="{{ .Title }}">
                            {{ else if .Params.featured_image }}
                            <img src="{{ .Params.featured_image | absURL }}" alt="{{ .Title }}">
                            {{ else }}
                            <img src="/android-chrome-192x192.png" alt="{{ .Title }}">
                            {{ end }}
                        </div>
                        {{ end }}
                    </a>
                    {{ end }}
                    {{ end }}
                    {{ else }}
                    {{/* Default: Show only immediate child pages (sections/categories) */}}
                    {{ range .Pages }}
                    {{ if not .Params.hideFromListing }}
                    <a href="{{ .Permalink }}" class="service-card" data-title="{{ .Title | lower }}"
                        data-description="{{ with .Description }}{{ . | lower }}{{ else }}{{ .Summary | plainify | lower }}{{ end }}"
                        data-tags="{{ if .Params.tags }}{{ delimit .Params.tags " " | lower }}{{ end }}">
                        <div class="card-header">
                            <h3>{{ .Title }}</h3>
                        </div>
                        <div class="card-content">
                            <div class="card-content-wrapper">
                                {{ if not $.Params.hideDescriptions }}
                                {{ with .Description }}
                                <p>{{ . }}</p>
                                {{ else }}
                                <p>{{ .Summary | plainify | truncate 150 }}</p>
                                {{ end }}
                                {{ end }}
                            </div>
                        </div>
                        {{ if not $.Params.hideThumbnails }}
                        <div class="card-thumbnail">
                            {{ if .Params.thumbnail }}
                            <img src="{{ .Params.thumbnail | absURL }}" alt="{{ .Title }}">
                            {{ else if .Params.featured_image }}
                            <img src="{{ .Params.featured_image | absURL }}" alt="{{ .Title }}">
                            {{ else }}
                            <img src="/android-chrome-192x192.png" alt="{{ .Title }}">
                            {{ end }}
                        </div>
                        {{ end }}
                    </a>
                    {{ end }}
                    {{ end }}
                    {{ end }}
                </div>

                {{/* Optional info section (configurable per section) */}}
                {{ if .Params.showInfoSection }}
                <div class="info-section">
                    <h2>{{ .Params.infoSectionTitle | default "Additional Information" }}</h2>
                    <div class="info-grid">
                        {{- range .Params.infoItems }}
                        <div class="info-item">
                            <h4>{{ .title }}</h4>
                            <p>{{ .description }}</p>
                        </div>
                        {{- end }}
                    </div>
                </div>
                {{ end }}

                {{ if .Params.schemaType }}
                {{/* Schema Markup */}}
                {{ if .IsSection }}
                <script type="application/ld+json">
                {
                  "@context": "https://schema.org",
                  "@type": "ItemList",
                  "name": "{{ .Params.schemaName | default .Title }}",
                  "description": "{{ .Params.schemaDescription | default .Description }}",
                  "url": "{{ .Permalink }}",
                  "numberOfItems": {{ len .Pages }},
                  "itemListElement": [
                    {{ range $index, $page := .Pages }}
                    {
                      "@type": "{{ $.Params.schemaItemType | default "Article" }}",
                      "position": {{ add $index 1 }},
                      {{ if eq $.Params.schemaItemType "SoftwareApplication" }}
                      "name": "{{ $page.Title }}",
                      "applicationCategory": "{{ $.Params.schemaCategory | default "Productivity" }}",
                      {{ else if eq $.Params.schemaItemType "SoftwareSourceCode" }}
                      "name": "{{ $page.Title }}",
                      "programmingLanguage": "{{ $.Params.schemaProgrammingLanguage | default "Docker" }}",
                      {{ else }}
                      "headline": "{{ $page.Title }}",
                      "datePublished": "{{ $page.Date.Format "2006-01-02" }}",
                      {{ if $page.Lastmod }}"dateModified": "{{ $page.Lastmod.Format "2006-01-02" }}",{{ end }}
                      "author": {
                        "@type": "Person",
                        "name": "{{ if $page.Params.author }}{{ $page.Params.author }}{{ else }}{{ $.Params.defaultAuthor | default "JonesCKevin" }}{{ end }}"
                      },
                      "keywords": "{{ if $page.Params.tags }}{{ delimit $page.Params.tags ", " }}{{ end }}",
                      {{ end }}
                      "description": "{{ if $page.Params.description }}{{ $page.Params.description }}{{ else }}{{ $page.Summary | plainify | truncate 160 }}{{ end }}",
                      "url": "{{ $page.Permalink }}"
                    }{{ if ne $index (sub (len $.Pages) 1) }},{{ end }}
                    {{ end }}
                  ]
                }
                </script>
                {{ end }}
                {{ end }}
            </main>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <p>&copy; 2025 TheGongShow. All rights reserved.</p>
                {{ if .Params.footerNote }}
                <p>{{ .Params.footerNote }}</p>
                {{ end }}
            </div>
        </footer>
    </div>

    {{ partial "javascript.html" . }}

    {{ if not .Params.disableSearch }}
    <!-- Search Filter Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('sectionSearch');
            const searchResults = document.getElementById('searchResults');
            const servicesGrid = document.getElementById('servicesGrid');
            const serviceCards = servicesGrid.querySelectorAll('.service-card');

            let noResultsDiv = null;

            searchInput.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase().trim();

                searchResults.innerHTML = '';

                if (searchTerm === '') {
                    serviceCards.forEach(card => card.style.display = '');
                    if (noResultsDiv) noResultsDiv.remove();
                    searchResults.style.display = 'none';
                    return;
                }

                let visibleCount = 0;

                serviceCards.forEach(card => {
                    const title = card.getAttribute('data-title');
                    const description = card.getAttribute('data-description');
                    const tags = card.getAttribute('data-tags');

                    if (title.includes(searchTerm) || description.includes(searchTerm) || tags.includes(searchTerm)) {
                        card.style.display = '';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });

                if (visibleCount > 0) {
                    searchResults.innerHTML = `<span style="color: var(--accent); font-weight: bold;">${visibleCount} {{ .Params.searchResultLabel | default "item" }}${visibleCount !== 1 ? 's' : ''} found</span>`;
                    searchResults.style.display = 'block';
                    if (noResultsDiv) noResultsDiv.remove();
                } else {
                    searchResults.innerHTML = '<span style="color: var(--accent);">No {{ .Params.searchResultLabel | default "items" }} found matching your search</span>';
                    searchResults.style.display = 'block';

                    if (!noResultsDiv) {
                        noResultsDiv = document.createElement('div');
                        noResultsDiv.className = 'no-results-message';
                        noResultsDiv.innerHTML = `
                            <div style="text-align: center; padding: 60px 20px; grid-column: 1 / -1;">
                                <h3 style="color: var(--accent); margin-bottom: 15px;">No {{ .Params.searchNoResultsTitle | default "Items" }} Found</h3>
                                <p style="opacity: 0.8; margin-bottom: 20px;">Try a different search term or browse all available {{ .Params.searchResultLabel | default "items" }}.</p>
                                <button onclick="document.getElementById('sectionSearch').value = ''; document.getElementById('sectionSearch').dispatchEvent(new Event('input'));" style="background: linear-gradient(135deg, var(--accent), var(--accent-light)); color: var(--accent-button-text); border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold;">Clear Search</button>
                            </div>
                        `;
                        servicesGrid.appendChild(noResultsDiv);
                    }
                }
            });

            searchInput.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    this.value = '';
                    this.dispatchEvent(new Event('input'));
                    this.blur();
                }
            });
        });
    </script>
    {{ end }}

    {{ if eq .Section "ai-tools" }}
    <!-- AI Tools Help Toggle Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const pageHelpToggle = document.getElementById('page-ai-help-toggle');
            const pageHelpSection = document.getElementById('page-ai-help-section');

            // Update provider-specific links on the page
            function updatePageProviderLinks() {
                const provider = localStorage.getItem('ai-provider') || 'openai';
                const pageProviderLink = document.getElementById('page-provider-link');
                const pageKeyFormat = document.getElementById('page-key-format');
                const pagePricingLink = document.getElementById('page-pricing-link');

                const providerInfo = {
                    openai: {
                        url: 'https://platform.openai.com/api-keys',
                        name: 'OpenAI API website',
                        keyFormat: 'sk-...',
                        pricing: 'https://openai.com/api/pricing/'
                    },
                    deepseek: {
                        url: 'https://platform.deepseek.com/api_keys',
                        name: 'DeepSeek API website',
                        keyFormat: 'sk-...',
                        pricing: 'https://platform.deepseek.com/api-docs/pricing'
                    },
                    anthropic: {
                        url: 'https://console.anthropic.com/settings/keys',
                        name: 'Anthropic API website',
                        keyFormat: 'sk-ant-...',
                        pricing: 'https://www.anthropic.com/pricing'
                    },
                    gemini: {
                        url: 'https://aistudio.google.com/app/apikey',
                        name: 'Google AI Studio',
                        keyFormat: 'AIza...',
                        pricing: 'https://ai.google.dev/pricing'
                    },
                    grok: {
                        url: 'https://console.x.ai/',
                        name: 'Grok (X.AI) Console',
                        keyFormat: 'xai-...',
                        pricing: 'https://x.ai/api'
                    },
                    custom: {
                        url: 'https://ollama.com/',
                        name: 'Ollama / LM Studio',
                        keyFormat: 'Optional',
                        pricing: 'https://github.com/ollama/ollama'
                    }
                };

                const info = providerInfo[provider] || providerInfo.openai;

                if (pageProviderLink) {
                    pageProviderLink.href = info.url;
                    pageProviderLink.textContent = info.name;
                }

                if (pageKeyFormat) {
                    pageKeyFormat.innerHTML = `Format: <code>${info.keyFormat}</code>`;
                }

                if (pagePricingLink) {
                    pagePricingLink.href = info.pricing;
                }
            }

            // Update links on page load
            updatePageProviderLinks();

            // Listen for provider changes from header
            window.addEventListener('storage', function (e) {
                if (e.key === 'ai-provider') {
                    updatePageProviderLinks();
                }
            });

            if (pageHelpToggle && pageHelpSection) {
                pageHelpToggle.addEventListener('click', function (e) {
                    e.stopPropagation();

                    // Check if we're about to SHOW the help (currently hidden)
                    const isCurrentlyHidden = pageHelpSection.style.display === 'none' || pageHelpSection.style.display === '';

                    if (isCurrentlyHidden) {
                        // SHOWING help - toggle page help AND open header
                        pageHelpSection.style.display = 'block';
                        pageHelpToggle.setAttribute('aria-label', 'Hide AI Tools Help');

                        // Update links when showing help
                        updatePageProviderLinks();

                        // Open the header AI dropdown and show help
                        const headerAiDropdown = document.querySelector('.ai-dropdown');
                        const headerHelpSection = document.getElementById('ai-help-section');
                        const headerInstructionsRow = document.getElementById('ai-instructions-row');
                        const headerHelpToggle = document.getElementById('ai-help-toggle');

                        if (headerAiDropdown && headerHelpSection) {
                            // Open the AI dropdown in header
                            headerAiDropdown.classList.add('open');

                            // Show the help section and instructions row in header
                            if (headerHelpSection.style.display !== 'block') {
                                headerHelpSection.style.display = 'block';
                                if (headerInstructionsRow) headerInstructionsRow.style.display = 'block';
                                if (headerHelpToggle) {
                                    headerHelpToggle.setAttribute('aria-label', 'Hide AI Tools Help');
                                }
                            }

                            // Scroll to the header AI dropdown
                            setTimeout(() => {
                                headerAiDropdown.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }, 100);
                        }
                    } else {
                        // HIDING help - only toggle page help, don't touch header
                        pageHelpSection.style.display = 'none';
                        pageHelpToggle.setAttribute('aria-label', 'Show AI Tools Help');
                    }
                });
            }
        });
    </script>
    {{ end }}
</body>

</html>