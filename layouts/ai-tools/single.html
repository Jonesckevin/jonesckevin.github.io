<!DOCTYPE html>
<html lang="{{ .Site.Language }}">

<head>
    {{ partial "head.html" . }}

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/ai-tools-pages.css">
</head>

<body class="section-{{ lower .Section }}">

    <div class="container">
        {{ partial "header.html" . }}
        {{ partial "side-menu-LR.html" . }}

        <div class="content">
            <main class="main-content">
                <!-- AI Tools Interface Layout. Shows you the MD Page Data -->
                {{ .Content }}

                {{ if .Params.pageScript }}
                <script src="{{ .Site.BaseURL }}{{ .Params.pageScript }}"></script>
                {{ end }}
            </main>
        </div>
    </div>

    {{ partial "javascript.html" . }}

    <!-- Sets the Content Design and Shape for the AI Tools Layout -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Reorganize content into side-by-side layout
            const mainContent = document.querySelector('.main-content');
            if (!mainContent) return;

            // Find form and result elements
            const form = mainContent.querySelector('form');
            const loadingDiv = document.getElementById('loadingDiv');
            const errorDiv = document.getElementById('errorDiv');
            const resultDiv = document.getElementById('resultDiv');

            // Only proceed if we have a form
            if (!form) return;

            // Create wrapper structure
            const wrapper = document.createElement('div');
            wrapper.className = 'ai-tools-layout';

            const formSection = document.createElement('div');
            formSection.className = 'ai-form-section';

            const divider = document.createElement('div');
            divider.className = 'layout-divider';
            divider.title = 'Drag to resize';

            const resultsSection = document.createElement('div');
            resultsSection.className = 'ai-results-section';

            // Get all content before the form
            const elementsBeforeForm = [];
            let currentElement = mainContent.firstElementChild;
            while (currentElement && currentElement !== form) {
                elementsBeforeForm.push(currentElement);
                currentElement = currentElement.nextElementSibling;
            }

            // Move header content (h1, p, etc.) before the form to form section
            elementsBeforeForm.forEach(el => {
                formSection.appendChild(el);
            });

            // Move form to form section
            if (form) {
                formSection.appendChild(form);
            }

            // Move result-related divs to results section
            if (loadingDiv) resultsSection.appendChild(loadingDiv);
            if (errorDiv) resultsSection.appendChild(errorDiv);
            if (resultDiv) resultsSection.appendChild(resultDiv);

            // Append sections to wrapper
            wrapper.appendChild(formSection);
            wrapper.appendChild(divider);
            wrapper.appendChild(resultsSection);

            // Clear main content and append wrapper
            mainContent.innerHTML = '';
            mainContent.appendChild(wrapper);

            // Add resize functionality for larger screens
            if (window.innerWidth >= 1024) {
                initResizer(wrapper, formSection, divider, resultsSection);
            }

            // Reinitialize resizer on window resize
            let resizeTimeout;
            window.addEventListener('resize', function () {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function () {
                    if (window.innerWidth >= 1024) {
                        initResizer(wrapper, formSection, divider, resultsSection);
                    } else {
                        // Reset to default grid on mobile
                        wrapper.style.gridTemplateColumns = '1fr';
                        formSection.style.width = '';
                        resultsSection.style.width = '';
                    }
                }, 250);
            });
        });

        function initResizer(wrapper, formSection, divider, resultsSection) {
            let isResizing = false;
            let startX = 0;
            let startWidth = 0;
            const minWidth = 300;
            const maxWidth = 800;

            divider.addEventListener('mousedown', function (e) {
                isResizing = true;
                startX = e.clientX;
                startWidth = formSection.offsetWidth;
                divider.classList.add('dragging');
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });

            document.addEventListener('mousemove', function (e) {
                if (!isResizing) return;

                const deltaX = e.clientX - startX;
                let newWidth = startWidth + deltaX;

                // Constrain width
                newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));

                // Update grid template
                wrapper.style.gridTemplateColumns = `${newWidth}px 4px 1fr`;

                // Save to localStorage
                localStorage.setItem('ai-tools-form-width', newWidth);
            });

            document.addEventListener('mouseup', function () {
                if (isResizing) {
                    isResizing = false;
                    divider.classList.remove('dragging');
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });

            // Load saved width from localStorage
            const savedWidth = localStorage.getItem('ai-tools-form-width');
            if (savedWidth && window.innerWidth >= 1024) {
                const width = parseInt(savedWidth);
                if (width >= minWidth && width <= maxWidth) {
                    wrapper.style.gridTemplateColumns = `${width}px 4px 1fr`;
                }
            }
        }
    </script>
</body>

</html>